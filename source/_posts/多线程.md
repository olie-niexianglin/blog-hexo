---
title: 多线程相关
date: 2020-06-28 20:45:29
tags:
---

### 先验知识
CAS: Compare And Swap（比较和交换），也称作自旋锁，在无锁的情况下实现并发操作，而且可以保证数据并发安全。


{% codeblock lang:java %}
public final int getAndAddInt(Object var1, long var2, int var4) {
    int var5;
    do {
        var5 = this.getIntVolatile(var1, var2);
    } while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4));
    return var5;
}
{% endcodeblock %}

{% asset_img cas.png This is an example image %}

ABA 问题：两个线程，其中一个线程将目标数值 A 从原始值加 1 ，然后又进行减 1 ，经过这两步操作之后，目标数值 A 
的值并没有发生变化，那么在 CAS 算法下，线程 B 就无法感知到这个变化。
{% blockquote %}
解决方案：记录目标数据变化的同时，加一个版本号的概念
{% endblockquote %}

